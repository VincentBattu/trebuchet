#include "glwindow.h"
#include <QDebug>
#include <GL/glu.h>
#include <QOpenGLTexture>

GLWindow::GLWindow(QWidget *parent) : GLWidget(60, parent, "Test")
{
    yRot = 0;
}

void GLWindow::initializeGL(){
    glShadeModel(GL_SMOOTH);
    glEnable(GL_TEXTURE_2D);
    qglClearColor(Qt::black);
    glClearDepth(1.0f);

    // Active le Z-buffer
    glEnable(GL_DEPTH_TEST);
    glDepthFunc(GL_LEQUAL);
   // glHint(GL_PERSPECTIVE_CORRECTION_HINT, GL_NICEST);

}

void GLWindow::setYRotation(int angle){
    yRot = angle;
}

void GLWindow::resizeGL(int width, int height){
    int side = qMin(width, height);

    // Définit la taille de la fenêtre d'affichage
    glViewport(0, 0, width, height);

    // Définition de la caméra adapté à cette fenêtre
    glMatrixMode(GL_PROJECTION);
    glLoadIdentity();
    gluPerspective(70.0f, (GLfloat)width/(GLfloat)height, 0.1f, 100.0f);

    // On réinitialise la matrice d'affichage
    glMatrixMode(GL_MODELVIEW);
    glLoadIdentity();

}

GLuint loadtgadisplayCDV ( const char* filename )
{
    FILE* fp;
    char magic[12];
    unsigned char header[6];
    int imageSize;
    GLenum type;
    char temp;
    int i;
    int bpp,width,height;
    GLuint textureId;
    int globalWidth = 1;
    int globalHeight = 1;
    char* imageData;
    char* imageTmp;
    if(!(fp = fopen(filename, "rb"))) return 0;
    if(!fread(&magic, 12, 1, fp)) return 0;
    if(!fread(&header, 6, 1, fp)) return 0;
    bpp = header[4];
    width  = header[1] * 256 + header[0];
    height = header[3] * 256 + header[2];
    if(width <= 0 || height <= 0) return 0;
    if(bpp != 24 && bpp != 32) return 0;
    imageSize = width * height * (bpp / 8);
    imageData = (char *)malloc(sizeof(char) * imageSize);
    if(imageData == NULL) return 0;
    if(!fread(imageData, imageSize, 1, fp)) { free(imageData); return 0; }
    for(i = 0; i < imageSize; i += bpp / 8) {
    temp = imageData[i];
    imageData[i] = imageData[i + 2];
    imageData[i + 2] = temp; }
    if(bpp == 32) for(i=0;i<imageSize;i+=4) imageData[i+3]=255-imageData[i+3];
    fclose(fp);
    while (width>globalWidth) globalWidth*=2;
    while (height>globalHeight) globalHeight*=2;
    glEnable( GL_TEXTURE_2D );
    glGenTextures(1, &textureId);
    glBindTexture(GL_TEXTURE_2D, textureId);
    glTexParameterf(GL_TEXTURE_2D,GL_TEXTURE_WRAP_S,GL_REPEAT);
    glTexParameterf(GL_TEXTURE_2D,GL_TEXTURE_WRAP_T,GL_REPEAT);
    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
    glPixelStorei(GL_UNPACK_ROW_LENGTH,globalWidth);
    glPixelStorei(GL_UNPACK_ALIGNMENT,1);
    if(bpp == 24) type=GL_RGB; else type=GL_RGBA;
    imageTmp = (char *)malloc(sizeof(char)*globalWidth*globalHeight*4);
    if (imageTmp==NULL) return 0;
    glTexImage2D(GL_TEXTURE_2D,0,type,globalWidth,globalHeight,0,
    type,GL_UNSIGNED_BYTE,imageTmp);
    free (imageTmp );
    glPixelStorei(GL_UNPACK_ROW_LENGTH,width);
    glTexSubImage2D(GL_TEXTURE_2D,0, 0,0, width, height,
    type ,GL_UNSIGNED_BYTE, imageData );
    free(imageData);
    return textureId;
}

void GLWindow::drawTerrain(){
    QOpenGLTexture *texture = new QOpenGLTexture(QImage("../trebuchet/grass.jpg").mirrored());
    texture->setMinificationFilter(QOpenGLTexture::LinearMipMapLinear);
    texture->setMagnificationFilter(QOpenGLTexture::Linear);
    texture->bind();
   glColor3ub(255,255,255);
   int step=10;
    for (int i =-100; i <=100-step; i+=step){
        for (int j =-100; j <=100-step; j+=step){
            glBegin(GL_QUADS);
                glTexCoord2d(0,0);
                glVertex3d(i,0,j);
                glTexCoord2d(0,1);
                glVertex3d(i+step,0,j);
                glTexCoord2d(1,1);
                glVertex3d(i+step,0,j+step);
                glTexCoord2d(1,0);
                glVertex3d(i,0,j+step);
            glEnd();
        }
    }

}

void GLWindow::drawFence(){
    int width = 8;
    int height = 2;
    QOpenGLTexture *texture = new QOpenGLTexture(QImage("../trebuchet/fence.png").mirrored());
    texture->setMinificationFilter(QOpenGLTexture::LinearMipMapLinear);
    texture->setMagnificationFilter(QOpenGLTexture::Linear);
    texture->bind();
    glPushMatrix();
    glMatrixMode( GL_MODELVIEW );
   // glLoadIdentity( );
        glBegin(GL_QUADS);
           glTexCoord2d(0,0);
            glVertex3d(-width/2,0,0);
            glTexCoord2d(0,5);
            glVertex3d(width/2,0,0);
            glTexCoord2d(1,5);
            glVertex3d(width/2,height,0);
            glTexCoord2d(1,0);
            glVertex3d(-width/2,height,0);
        glEnd();
        gluCylinder(gluNewQuadric(),1.0,1,3,30,30);
    glPopMatrix();
}


void GLWindow::paintGL(){
    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
            glLoadIdentity();
            gluLookAt(0,3,-5,0,0,0,0,1,0);

            drawFence();

           // drawTerrain();
            glRotatef(yRot,0,1,0);

       /* this->displayCDVDisplayList();

        glPushMatrix ();
            glTranslatef(0,1.5,0);
            //glColor3f(0.8,0.8,0.8);
            glCallList (glGenLists(1));
        glPopMatrix ();

        glPushMatrix ();
            glTranslatef(0,-1.5,0);
            glRotatef(-180,0,0,1);
            //glColor3f(0.8,0.8,0.8);
            glCallList (glGenLists(1));
        glPopMatrix ();

        glEnable( GL_TEXTURE_2D );
        glDisable( GL_CULL_FACE );
        /* BIND TEXTURE */
        /*
        glBindTexture(GL_TEXTURE_2D, loadtgadisplayCDV( "./bois_trebuchet3.png"));
        glBegin(GL_QUAD_STRIP);
            glTexCoord2f (0,0);
            glVertex3f(0.3,-5,0);
            glTexCoord2f (0,0.644531);
            glVertex3f(0.3,5,0);
            glTexCoord2f (0.976563,0);
            glVertex3f(0.3,-5,0.6);
            glTexCoord2f (0.976563,0.644531);
            glVertex3f(0.3,5,0.6);
            glTexCoord2f (0,0);
            glVertex3f(-0.3,-5,0.6);
            glTexCoord2f (0,0.644531);
            glVertex3f(-0.3,5,0.6);
            glTexCoord2f (0.976563,0);
            glVertex3f(-0.3,-5,0);
            glTexCoord2f (0.976563,0.644531);
            glVertex3f(-0.3,5,0);
            glTexCoord2f (0,0);
            glVertex3f(0.3,-5,0);
            glTexCoord2f (0,0.644531);
            glVertex3f(0.3,5,0);
        glEnd();
        glBegin(GL_QUADS);
            glTexCoord2f (0,0);
            glVertex3f(0.3,5,0);
            glTexCoord2f (0,0.644531);
            glVertex3f(-0.3,5,0);
            glTexCoord2f (0.976563,0.644531);
            glVertex3f(-0.3,5,0.6);
            glTexCoord2f (0.976563,0);
            glVertex3f(0.3,5,0.6);
        glEnd();
        glBegin(GL_QUADS);
            glTexCoord2f (0,0);
            glVertex3f(-0.3,-5,0);
            glTexCoord2f (0,0.644531);
            glVertex3f(0.3,-5,0);
            glTexCoord2f (0.976563,0.644531);
            glVertex3f(0.3,-5,0.6);
            glTexCoord2f (0.976563,0);
            glVertex3f(-0.3,-5,0.6);
        glEnd();

        glDisable( GL_TEXTURE_2D );
        glEnable( GL_CULL_FACE );
        glPushMatrix ();
            glColor3f(0.4,0.4,0.2);
            glTranslatef(0,0,9.2);
            glRotatef(90,1,0,0);
            glRotatef(90,0,0,1);
            glScalef(0.9,0.9,2.5);
            glBegin ( GL_TRIANGLES );
                glNormal3f(0.702714,-1.06018e-008,-0.711473);
                glVertex3f(0.5,0,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(0.66832,0.21715,-0.711473);
                glVertex3f(0.475528,0.154509,-0.5);
                glNormal3f(0.66832,0.21715,-0.711473);
                glVertex3f(0.475528,0.154509,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(0.568507,0.413045,-0.711473);
                glVertex3f(0.404509,0.293893,-0.5);
                glNormal3f(0.568507,0.413045,-0.711473);
                glVertex3f(0.404509,0.293893,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(0.413045,0.568507,-0.711473);
                glVertex3f(0.293893,0.404509,-0.5);
                glNormal3f(0.413045,0.568507,-0.711473);
                glVertex3f(0.293893,0.404509,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(0.21715,0.66832,-0.711473);
                glVertex3f(0.154508,0.475528,-0.5);
                glNormal3f(0.21715,0.66832,-0.711473);
                glVertex3f(0.154508,0.475528,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(-6.36106e-008,0.702713,-0.711473);
                glVertex3f(-2.18557e-008,0.5,-0.5);
                glNormal3f(-6.36106e-008,0.702713,-0.711473);
                glVertex3f(-2.18557e-008,0.5,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(-0.21715,0.66832,-0.711473);
                glVertex3f(-0.154509,0.475528,-0.5);
                glNormal3f(-0.21715,0.66832,-0.711473);
                glVertex3f(-0.154509,0.475528,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(-0.413045,0.568507,-0.711473);
                glVertex3f(-0.293893,0.404509,-0.5);
                glNormal3f(-0.413045,0.568507,-0.711473);
                glVertex3f(-0.293893,0.404509,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(-0.568507,0.413045,-0.711473);
                glVertex3f(-0.404509,0.293893,-0.5);
                glNormal3f(-0.568507,0.413045,-0.711473);
                glVertex3f(-0.404509,0.293893,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(-0.66832,0.21715,-0.711473);
                glVertex3f(-0.475528,0.154508,-0.5);
                glNormal3f(-0.66832,0.21715,-0.711473);
                glVertex3f(-0.475528,0.154508,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(-0.702714,-6.36106e-008,-0.711473);
                glVertex3f(-0.5,-4.37114e-008,-0.5);
                glNormal3f(-0.702714,-6.36106e-008,-0.711473);
                glVertex3f(-0.5,-4.37114e-008,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(-0.66832,-0.21715,-0.711473);
                glVertex3f(-0.475528,-0.154508,-0.5);
                glNormal3f(-0.66832,-0.21715,-0.711473);
                glVertex3f(-0.475528,-0.154508,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(-0.568507,-0.413045,-0.711473);
                glVertex3f(-0.404508,-0.293893,-0.5);
                glNormal3f(-0.568507,-0.413045,-0.711473);
                glVertex3f(-0.404508,-0.293893,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(-0.413045,-0.568507,-0.711473);
                glVertex3f(-0.293893,-0.404509,-0.5);
                glNormal3f(-0.413045,-0.568507,-0.711473);
                glVertex3f(-0.293893,-0.404509,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(-0.21715,-0.66832,-0.711473);
                glVertex3f(-0.154509,-0.475528,-0.5);
                glNormal3f(-0.21715,-0.66832,-0.711473);
                glVertex3f(-0.154509,-0.475528,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(0,-0.702714,-0.711473);
                glVertex3f(5.96244e-009,-0.5,-0.5);
                glNormal3f(0,-0.702714,-0.711473);
                glVertex3f(5.96244e-009,-0.5,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(0.217151,-0.66832,-0.711473);
                glVertex3f(0.154509,-0.475528,-0.5);
                glNormal3f(0.217151,-0.66832,-0.711473);
                glVertex3f(0.154509,-0.475528,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(0.413045,-0.568507,-0.711473);
                glVertex3f(0.293893,-0.404508,-0.5);
                glNormal3f(0.413045,-0.568507,-0.711473);
                glVertex3f(0.293893,-0.404508,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(0.568507,-0.413044,-0.711473);
                glVertex3f(0.404509,-0.293892,-0.5);
                glNormal3f(0.568507,-0.413044,-0.711473);
                glVertex3f(0.404509,-0.293892,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(0.66832,-0.21715,-0.711473);
                glVertex3f(0.475528,-0.154508,-0.5);
                glNormal3f(0.66832,-0.21715,-0.711473);
                glVertex3f(0.475528,-0.154508,-0.5);
                glNormal3f(0,0,-1);
                glVertex3f(0,0,-0.5);
                glNormal3f(0.702714,-1.06018e-008,-0.711473);
                glVertex3f(0.5,0,-0.5);
                glNormal3f(0.66832,0.21715,0.711473);
                glVertex3f(0.475528,0.154509,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(0.702714,-1.06018e-008,0.711473);
                glVertex3f(0.5,0,0.5);
                glNormal3f(0.568507,0.413045,0.711473);
                glVertex3f(0.404509,0.293893,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(0.66832,0.21715,0.711473);
                glVertex3f(0.475528,0.154509,0.5);
                glNormal3f(0.413045,0.568507,0.711473);
                glVertex3f(0.293893,0.404509,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(0.568507,0.413045,0.711473);
                glVertex3f(0.404509,0.293893,0.5);
                glNormal3f(0.21715,0.66832,0.711473);
                glVertex3f(0.154508,0.475528,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(0.413045,0.568507,0.711473);
                glVertex3f(0.293893,0.404509,0.5);
                glNormal3f(-6.36106e-008,0.702713,0.711473);
                glVertex3f(-2.18557e-008,0.5,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(0.21715,0.66832,0.711473);
                glVertex3f(0.154508,0.475528,0.5);
                glNormal3f(-0.21715,0.66832,0.711473);
                glVertex3f(-0.154509,0.475528,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(-6.36106e-008,0.702713,0.711473);
                glVertex3f(-2.18557e-008,0.5,0.5);
                glNormal3f(-0.413045,0.568507,0.711473);
                glVertex3f(-0.293893,0.404509,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(-0.21715,0.66832,0.711473);
                glVertex3f(-0.154509,0.475528,0.5);
                glNormal3f(-0.568507,0.413045,0.711473);
                glVertex3f(-0.404509,0.293893,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(-0.413045,0.568507,0.711473);
                glVertex3f(-0.293893,0.404509,0.5);
                glNormal3f(-0.66832,0.21715,0.711473);
                glVertex3f(-0.475528,0.154508,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(-0.568507,0.413045,0.711473);
                glVertex3f(-0.404509,0.293893,0.5);
                glNormal3f(-0.702714,-6.36106e-008,0.711473);
                glVertex3f(-0.5,-4.37114e-008,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(-0.66832,0.21715,0.711473);
                glVertex3f(-0.475528,0.154508,0.5);
                glNormal3f(-0.66832,-0.21715,0.711473);
                glVertex3f(-0.475528,-0.154508,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(-0.702714,-6.36106e-008,0.711473);
                glVertex3f(-0.5,-4.37114e-008,0.5);
                glNormal3f(-0.568507,-0.413045,0.711473);
                glVertex3f(-0.404508,-0.293893,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(-0.66832,-0.21715,0.711473);
                glVertex3f(-0.475528,-0.154508,0.5);
                glNormal3f(-0.413045,-0.568507,0.711473);
                glVertex3f(-0.293893,-0.404509,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(-0.568507,-0.413045,0.711473);
                glVertex3f(-0.404508,-0.293893,0.5);
                glNormal3f(-0.21715,-0.66832,0.711473);
                glVertex3f(-0.154509,-0.475528,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(-0.413045,-0.568507,0.711473);
                glVertex3f(-0.293893,-0.404509,0.5);
                glNormal3f(0,-0.702714,0.711473);
                glVertex3f(5.96244e-009,-0.5,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(-0.21715,-0.66832,0.711473);
                glVertex3f(-0.154509,-0.475528,0.5);
                glNormal3f(0.217151,-0.66832,0.711473);
                glVertex3f(0.154509,-0.475528,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(0,-0.702714,0.711473);
                glVertex3f(5.96244e-009,-0.5,0.5);
                glNormal3f(0.413045,-0.568507,0.711473);
                glVertex3f(0.293893,-0.404508,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(0.217151,-0.66832,0.711473);
                glVertex3f(0.154509,-0.475528,0.5);
                glNormal3f(0.568507,-0.413044,0.711473);
                glVertex3f(0.404509,-0.293892,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(0.413045,-0.568507,0.711473);
                glVertex3f(0.293893,-0.404508,0.5);
                glNormal3f(0.66832,-0.21715,0.711473);
                glVertex3f(0.475528,-0.154508,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(0.568507,-0.413044,0.711473);
                glVertex3f(0.404509,-0.293892,0.5);
                glNormal3f(0.702714,-1.06018e-008,0.711473);
                glVertex3f(0.5,0,0.5);
                glNormal3f(0,0,1);
                glVertex3f(0,0,0.5);
                glNormal3f(0.66832,-0.21715,0.711473);
                glVertex3f(0.475528,-0.154508,0.5);
            glEnd ();
            glBegin ( GL_QUADS );
                glNormal3f(0.702714,-1.06018e-008,-0.711473);
                glVertex3f(0.5,0,-0.5);
                glNormal3f(0.66832,0.21715,-0.711473);
                glVertex3f(0.475528,0.154509,-0.5);
                glNormal3f(0.66832,0.21715,0.711473);
                glVertex3f(0.475528,0.154509,0.5);
                glNormal3f(0.702714,-1.06018e-008,0.711473);
                glVertex3f(0.5,0,0.5);
                glNormal3f(0.66832,0.21715,-0.711473);
                glVertex3f(0.475528,0.154509,-0.5);
                glNormal3f(0.568507,0.413045,-0.711473);
                glVertex3f(0.404509,0.293893,-0.5);
                glNormal3f(0.568507,0.413045,0.711473);
                glVertex3f(0.404509,0.293893,0.5);
                glNormal3f(0.66832,0.21715,0.711473);
                glVertex3f(0.475528,0.154509,0.5);
                glNormal3f(0.568507,0.413045,-0.711473);
                glVertex3f(0.404509,0.293893,-0.5);
                glNormal3f(0.413045,0.568507,-0.711473);
                glVertex3f(0.293893,0.404509,-0.5);
                glNormal3f(0.413045,0.568507,0.711473);
                glVertex3f(0.293893,0.404509,0.5);
                glNormal3f(0.568507,0.413045,0.711473);
                glVertex3f(0.404509,0.293893,0.5);
                glNormal3f(0.413045,0.568507,-0.711473);
                glVertex3f(0.293893,0.404509,-0.5);
                glNormal3f(0.21715,0.66832,-0.711473);
                glVertex3f(0.154508,0.475528,-0.5);
                glNormal3f(0.21715,0.66832,0.711473);
                glVertex3f(0.154508,0.475528,0.5);
                glNormal3f(0.413045,0.568507,0.711473);
                glVertex3f(0.293893,0.404509,0.5);
                glNormal3f(0.21715,0.66832,-0.711473);
                glVertex3f(0.154508,0.475528,-0.5);
                glNormal3f(-6.36106e-008,0.702713,-0.711473);
                glVertex3f(-2.18557e-008,0.5,-0.5);
                glNormal3f(-6.36106e-008,0.702713,0.711473);
                glVertex3f(-2.18557e-008,0.5,0.5);
                glNormal3f(0.21715,0.66832,0.711473);
                glVertex3f(0.154508,0.475528,0.5);
                glNormal3f(-6.36106e-008,0.702713,-0.711473);
                glVertex3f(-2.18557e-008,0.5,-0.5);
                glNormal3f(-0.21715,0.66832,-0.711473);
                glVertex3f(-0.154509,0.475528,-0.5);
                glNormal3f(-0.21715,0.66832,0.711473);
                glVertex3f(-0.154509,0.475528,0.5);
                glNormal3f(-6.36106e-008,0.702713,0.711473);
                glVertex3f(-2.18557e-008,0.5,0.5);
                glNormal3f(-0.21715,0.66832,-0.711473);
                glVertex3f(-0.154509,0.475528,-0.5);
                glNormal3f(-0.413045,0.568507,-0.711473);
                glVertex3f(-0.293893,0.404509,-0.5);
                glNormal3f(-0.413045,0.568507,0.711473);
                glVertex3f(-0.293893,0.404509,0.5);
                glNormal3f(-0.21715,0.66832,0.711473);
                glVertex3f(-0.154509,0.475528,0.5);
                glNormal3f(-0.413045,0.568507,-0.711473);
                glVertex3f(-0.293893,0.404509,-0.5);
                glNormal3f(-0.568507,0.413045,-0.711473);
                glVertex3f(-0.404509,0.293893,-0.5);
                glNormal3f(-0.568507,0.413045,0.711473);
                glVertex3f(-0.404509,0.293893,0.5);
                glNormal3f(-0.413045,0.568507,0.711473);
                glVertex3f(-0.293893,0.404509,0.5);
                glNormal3f(-0.568507,0.413045,-0.711473);
                glVertex3f(-0.404509,0.293893,-0.5);
                glNormal3f(-0.66832,0.21715,-0.711473);
                glVertex3f(-0.475528,0.154508,-0.5);
                glNormal3f(-0.66832,0.21715,0.711473);
                glVertex3f(-0.475528,0.154508,0.5);
                glNormal3f(-0.568507,0.413045,0.711473);
                glVertex3f(-0.404509,0.293893,0.5);
                glNormal3f(-0.66832,0.21715,-0.711473);
                glVertex3f(-0.475528,0.154508,-0.5);
                glNormal3f(-0.702714,-6.36106e-008,-0.711473);
                glVertex3f(-0.5,-4.37114e-008,-0.5);
                glNormal3f(-0.702714,-6.36106e-008,0.711473);
                glVertex3f(-0.5,-4.37114e-008,0.5);
                glNormal3f(-0.66832,0.21715,0.711473);
                glVertex3f(-0.475528,0.154508,0.5);
                glNormal3f(-0.702714,-6.36106e-008,-0.711473);
                glVertex3f(-0.5,-4.37114e-008,-0.5);
                glNormal3f(-0.66832,-0.21715,-0.711473);
                glVertex3f(-0.475528,-0.154508,-0.5);
                glNormal3f(-0.66832,-0.21715,0.711473);
                glVertex3f(-0.475528,-0.154508,0.5);
                glNormal3f(-0.702714,-6.36106e-008,0.711473);
                glVertex3f(-0.5,-4.37114e-008,0.5);
                glNormal3f(-0.66832,-0.21715,-0.711473);
                glVertex3f(-0.475528,-0.154508,-0.5);
                glNormal3f(-0.568507,-0.413045,-0.711473);
                glVertex3f(-0.404508,-0.293893,-0.5);
                glNormal3f(-0.568507,-0.413045,0.711473);
                glVertex3f(-0.404508,-0.293893,0.5);
                glNormal3f(-0.66832,-0.21715,0.711473);
                glVertex3f(-0.475528,-0.154508,0.5);
                glNormal3f(-0.568507,-0.413045,-0.711473);
                glVertex3f(-0.404508,-0.293893,-0.5);
                glNormal3f(-0.413045,-0.568507,-0.711473);
                glVertex3f(-0.293893,-0.404509,-0.5);
                glNormal3f(-0.413045,-0.568507,0.711473);
                glVertex3f(-0.293893,-0.404509,0.5);
                glNormal3f(-0.568507,-0.413045,0.711473);
                glVertex3f(-0.404508,-0.293893,0.5);
                glNormal3f(-0.413045,-0.568507,-0.711473);
                glVertex3f(-0.293893,-0.404509,-0.5);
                glNormal3f(-0.21715,-0.66832,-0.711473);
                glVertex3f(-0.154509,-0.475528,-0.5);
                glNormal3f(-0.21715,-0.66832,0.711473);
                glVertex3f(-0.154509,-0.475528,0.5);
                glNormal3f(-0.413045,-0.568507,0.711473);
                glVertex3f(-0.293893,-0.404509,0.5);
                glNormal3f(-0.21715,-0.66832,-0.711473);
                glVertex3f(-0.154509,-0.475528,-0.5);
                glNormal3f(0,-0.702714,-0.711473);
                glVertex3f(5.96244e-009,-0.5,-0.5);
                glNormal3f(0,-0.702714,0.711473);
                glVertex3f(5.96244e-009,-0.5,0.5);
                glNormal3f(-0.21715,-0.66832,0.711473);
                glVertex3f(-0.154509,-0.475528,0.5);
                glNormal3f(0,-0.702714,-0.711473);
                glVertex3f(5.96244e-009,-0.5,-0.5);
                glNormal3f(0.217151,-0.66832,-0.711473);
                glVertex3f(0.154509,-0.475528,-0.5);
                glNormal3f(0.217151,-0.66832,0.711473);
                glVertex3f(0.154509,-0.475528,0.5);
                glNormal3f(0,-0.702714,0.711473);
                glVertex3f(5.96244e-009,-0.5,0.5);
                glNormal3f(0.217151,-0.66832,-0.711473);
                glVertex3f(0.154509,-0.475528,-0.5);
                glNormal3f(0.413045,-0.568507,-0.711473);
                glVertex3f(0.293893,-0.404508,-0.5);
                glNormal3f(0.413045,-0.568507,0.711473);
                glVertex3f(0.293893,-0.404508,0.5);
                glNormal3f(0.217151,-0.66832,0.711473);
                glVertex3f(0.154509,-0.475528,0.5);
                glNormal3f(0.413045,-0.568507,-0.711473);
                glVertex3f(0.293893,-0.404508,-0.5);
                glNormal3f(0.568507,-0.413044,-0.711473);
                glVertex3f(0.404509,-0.293892,-0.5);
                glNormal3f(0.568507,-0.413044,0.711473);
                glVertex3f(0.404509,-0.293892,0.5);
                glNormal3f(0.413045,-0.568507,0.711473);
                glVertex3f(0.293893,-0.404508,0.5);
                glNormal3f(0.568507,-0.413044,-0.711473);
                glVertex3f(0.404509,-0.293892,-0.5);
                glNormal3f(0.66832,-0.21715,-0.711473);
                glVertex3f(0.475528,-0.154508,-0.5);
                glNormal3f(0.66832,-0.21715,0.711473);
                glVertex3f(0.475528,-0.154508,0.5);
                glNormal3f(0.568507,-0.413044,0.711473);
                glVertex3f(0.404509,-0.293892,0.5);
                glNormal3f(0.66832,-0.21715,-0.711473);
                glVertex3f(0.475528,-0.154508,-0.5);
                glNormal3f(0.702714,-1.06018e-008,-0.711473);
                glVertex3f(0.5,0,-0.5);
                glNormal3f(0.702714,-1.06018e-008,0.711473);
                glVertex3f(0.5,0,0.5);
                glNormal3f(0.66832,-0.21715,0.711473);
                glVertex3f(0.475528,-0.154508,0.5);
            glEnd ();
            glPushMatrix ();
                glColor3f(0.4,0.4,0.2);
                glTranslatef(0,4,0);
                glRotatef(90,1,0,0);
                glScalef(0.7,0.25,17);
                glBegin ( GL_QUADS );
                    glNormal3f(-0.57735,-0.57735,-0.57735);
                    glVertex3f(-0.5,-0.5,-0.5);
                    glNormal3f(-0.57735,-0.57735,0.57735);
                    glVertex3f(-0.5,-0.5,0.5);
                    glNormal3f(-0.57735,0.57735,0.57735);
                    glVertex3f(-0.5,0.5,0.5);
                    glNormal3f(-0.57735,0.57735,-0.57735);
                    glVertex3f(-0.5,0.5,-0.5);
                    glNormal3f(-0.57735,-0.57735,0.57735);
                    glVertex3f(-0.5,-0.5,0.5);
                    glNormal3f(0.57735,-0.57735,0.57735);
                    glVertex3f(0.5,-0.5,0.5);
                    glNormal3f(0.57735,0.57735,0.57735);
                    glVertex3f(0.5,0.5,0.5);
                    glNormal3f(-0.57735,0.57735,0.57735);
                    glVertex3f(-0.5,0.5,0.5);
                    glNormal3f(0.57735,-0.57735,0.57735);
                    glVertex3f(0.5,-0.5,0.5);
                    glNormal3f(0.57735,-0.57735,-0.57735);
                    glVertex3f(0.5,-0.5,-0.5);
                    glNormal3f(0.57735,0.57735,-0.57735);
                    glVertex3f(0.5,0.5,-0.5);
                    glNormal3f(0.57735,0.57735,0.57735);
                    glVertex3f(0.5,0.5,0.5);
                    glNormal3f(0.57735,-0.57735,-0.57735);
                    glVertex3f(0.5,-0.5,-0.5);
                    glNormal3f(-0.57735,-0.57735,-0.57735);
                    glVertex3f(-0.5,-0.5,-0.5);
                    glNormal3f(-0.57735,0.57735,-0.57735);
                    glVertex3f(-0.5,0.5,-0.5);
                    glNormal3f(0.57735,0.57735,-0.57735);
                    glVertex3f(0.5,0.5,-0.5);
                    glNormal3f(-0.57735,0.57735,0.57735);
                    glVertex3f(-0.5,0.5,0.5);
                    glNormal3f(0.57735,0.57735,0.57735);
                    glVertex3f(0.5,0.5,0.5);
                    glNormal3f(0.57735,0.57735,-0.57735);
                    glVertex3f(0.5,0.5,-0.5);
                    glNormal3f(-0.57735,0.57735,-0.57735);
                    glVertex3f(-0.5,0.5,-0.5);
                    glNormal3f(-0.57735,-0.57735,-0.57735);
                    glVertex3f(-0.5,-0.5,-0.5);
                    glNormal3f(0.57735,-0.57735,-0.57735);
                    glVertex3f(0.5,-0.5,-0.5);
                    glNormal3f(0.57735,-0.57735,0.57735);
                    glVertex3f(0.5,-0.5,0.5);
                    glNormal3f(-0.57735,-0.57735,0.57735);
                    glVertex3f(-0.5,-0.5,0.5);
                glEnd ();
            glPopMatrix ();
            glPushMatrix ();
                glColor3f(0.4,0.4,0.2);
                glTranslatef(-0.7,-4.3,0);
                glScalef(3,1.7,1);
                glBegin ( GL_QUADS );
                    glNormal3f(-0.57735,-0.57735,-0.57735);
                    glVertex3f(-0.5,-0.5,-0.5);
                    glNormal3f(-0.57735,-0.57735,0.57735);
                    glVertex3f(-0.5,-0.5,0.5);
                    glNormal3f(-0.57735,0.57735,0.57735);
                    glVertex3f(-0.5,0.5,0.5);
                    glNormal3f(-0.57735,0.57735,-0.57735);
                    glVertex3f(-0.5,0.5,-0.5);
                    glNormal3f(-0.57735,-0.57735,0.57735);
                    glVertex3f(-0.5,-0.5,0.5);
                    glNormal3f(0.57735,-0.57735,0.57735);
                    glVertex3f(0.5,-0.5,0.5);
                    glNormal3f(0.57735,0.57735,0.57735);
                    glVertex3f(0.5,0.5,0.5);
                    glNormal3f(-0.57735,0.57735,0.57735);
                    glVertex3f(-0.5,0.5,0.5);
                    glNormal3f(0.57735,-0.57735,0.57735);
                    glVertex3f(0.5,-0.5,0.5);
                    glNormal3f(0.57735,-0.57735,-0.57735);
                    glVertex3f(0.5,-0.5,-0.5);
                    glNormal3f(0.57735,0.57735,-0.57735);
                    glVertex3f(0.5,0.5,-0.5);
                    glNormal3f(0.57735,0.57735,0.57735);
                    glVertex3f(0.5,0.5,0.5);
                    glNormal3f(0.57735,-0.57735,-0.57735);
                    glVertex3f(0.5,-0.5,-0.5);
                    glNormal3f(-0.57735,-0.57735,-0.57735);
                    glVertex3f(-0.5,-0.5,-0.5);
                    glNormal3f(-0.57735,0.57735,-0.57735);
                    glVertex3f(-0.5,0.5,-0.5);
                    glNormal3f(0.57735,0.57735,-0.57735);
                    glVertex3f(0.5,0.5,-0.5);
                    glNormal3f(-0.57735,0.57735,0.57735);
                    glVertex3f(-0.5,0.5,0.5);
                    glNormal3f(0.57735,0.57735,0.57735);
                    glVertex3f(0.5,0.5,0.5);
                    glNormal3f(0.57735,0.57735,-0.57735);
                    glVertex3f(0.5,0.5,-0.5);
                    glNormal3f(-0.57735,0.57735,-0.57735);
                    glVertex3f(-0.5,0.5,-0.5);
                    glNormal3f(-0.57735,-0.57735,-0.57735);
                    glVertex3f(-0.5,-0.5,-0.5);
                    glNormal3f(0.57735,-0.57735,-0.57735);
                    glVertex3f(0.5,-0.5,-0.5);
                    glNormal3f(0.57735,-0.57735,0.57735);
                    glVertex3f(0.5,-0.5,0.5);
                    glNormal3f(-0.57735,-0.57735,0.57735);
                    glVertex3f(-0.5,-0.5,0.5);
                glEnd ();
            glPopMatrix ();
        glPopMatrix (); */
}

void GLWindow::displayCDVDisplayList()
        {
        glNewList ( glGenLists(1), GL_COMPILE_AND_EXECUTE );
        glPushMatrix ();
        glEnable( GL_TEXTURE_2D );
        glDisable( GL_CULL_FACE );
        /* BIND TEXTURE */
        glBindTexture(GL_TEXTURE_2D, loadtgadisplayCDV( "./bois_trebuchet3.png"));
        glBegin(GL_QUAD_STRIP);
        glTexCoord2f (0,0);
        glVertex3f(5,0.3,0);
        glTexCoord2f (0,0.644531);
        glVertex3f(-5,0.3,0);
        glTexCoord2f (0.976563,0);
        glVertex3f(5,-0.3,0);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(-5,-0.3,0);
        glTexCoord2f (0,0);
        glVertex3f(5,-0.3,0.6);
        glTexCoord2f (0,0.644531);
        glVertex3f(-5,-0.3,0.6);
        glTexCoord2f (0.976563,0);
        glVertex3f(5,0.3,0.6);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(-5,0.3,0.6);
        glTexCoord2f (0,0);
        glVertex3f(5,0.3,0);
        glTexCoord2f (0,0.644531);
        glVertex3f(-5,0.3,0);
        glEnd();
        glBegin(GL_QUADS);
        glTexCoord2f (0,0);
        glVertex3f(5,0.3,0);
        glTexCoord2f (0,0.644531);
        glVertex3f(5,0.3,0.6);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(5,-0.3,0.6);
        glTexCoord2f (0.976563,0);
        glVertex3f(5,-0.3,0);
        glEnd();
        glBegin(GL_QUADS);
        glTexCoord2f (0,0);
        glVertex3f(-5,0.3,0);
        glTexCoord2f (0,0.644531);
        glVertex3f(-5,-0.3,0);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(-5,-0.3,0.6);
        glTexCoord2f (0.976563,0);
        glVertex3f(-5,0.3,0.6);
        glEnd();
        glBegin(GL_QUAD_STRIP);
        glTexCoord2f (0,0);
        glVertex3f(0.3,0.3,0.6);
        glTexCoord2f (0,0.644531);
        glVertex3f(0.3,0.3,9);
        glTexCoord2f (0.976563,0);
        glVertex3f(-0.3,0.3,0.6);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(-0.3,0.3,9);
        glTexCoord2f (0,0);
        glVertex3f(-0.3,-0.3,0.6);
        glTexCoord2f (0,0.644531);
        glVertex3f(-0.3,-0.3,9);
        glTexCoord2f (0.976563,0);
        glVertex3f(0.3,-0.3,0.6);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(0.3,-0.3,9);
        glTexCoord2f (0,0);
        glVertex3f(0.3,0.3,0.6);
        glTexCoord2f (0,0.644531);
        glVertex3f(0.3,0.3,9);
        glEnd();
        glBegin(GL_QUAD_STRIP);
        glTexCoord2f (0,0);
        glVertex3f(4.5,0.3,0.6);
        glTexCoord2f (0,0.644531);
        glVertex3f(0.3,0.3,9);
        glTexCoord2f (0.976563,0);
        glVertex3f(3.9,0.3,0.6);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(0.3,0.3,7.6);
        glTexCoord2f (0,0);
        glVertex3f(3.9,-0.3,0.6);
        glTexCoord2f (0,0.644531);
        glVertex3f(0.3,7.29223e-039,7.6);
        glTexCoord2f (0.976563,0);
        glVertex3f(4.5,-0.3,0.6);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(0.3,-0.3,9);
        glTexCoord2f (0,0);
        glVertex3f(4.5,0.3,0.6);
        glTexCoord2f (0,0.644531);
        glVertex3f(0.3,0.3,9);
        glEnd();
        glBegin(GL_QUAD_STRIP);
        glTexCoord2f (0,0);
        glVertex3f(-4.5,0.3,0.6);
        glTexCoord2f (0,0.644531);
        glVertex3f(-0.3,0.3,9);
        glTexCoord2f (0.976563,0);
        glVertex3f(-3.9,0.3,0.6);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(-0.3,0.3,7.6);
        glTexCoord2f (0,0);
        glVertex3f(-3.9,-0.3,0.6);
        glTexCoord2f (0,0.644531);
        glVertex3f(-0.3,-0.3,7.6);
        glTexCoord2f (0.976563,0);
        glVertex3f(-4.5,-0.3,0.6);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(-0.3,-0.3,9);
        glTexCoord2f (0,0);
        glVertex3f(-4.5,0.3,0.6);
        glTexCoord2f (0,0.644531);
        glVertex3f(-0.3,0.3,9);
        glEnd();
        glBegin(GL_QUAD_STRIP);
        glTexCoord2f (0,0);
        glVertex3f(3.3,0.3,4.2);
        glTexCoord2f (0,0.644531);
        glVertex3f(-3.3,0.3,4.2);
        glTexCoord2f (0.976563,0);
        glVertex3f(3.3,0.7,4.2);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(-3.3,0.7,4.2);
        glTexCoord2f (0,0);
        glVertex3f(3.3,0.7,3.8);
        glTexCoord2f (0,0.644531);
        glVertex3f(-3.3,0.7,3.8);
        glTexCoord2f (0.976563,0);
        glVertex3f(3.3,0.3,3.8);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(-3.3,0.3,3.8);
        glTexCoord2f (0,0);
        glVertex3f(3.3,0.3,4.2);
        glTexCoord2f (0,0.644531);
        glVertex3f(-3.3,0.3,4.2);
        glEnd();
        glBegin(GL_QUADS);
        glTexCoord2f (0,0);
        glVertex3f(3.3,0.3,4.2);
        glTexCoord2f (0,0.644531);
        glVertex3f(3.3,0.7,4.2);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(3.3,0.7,3.8);
        glTexCoord2f (0.976563,0);
        glVertex3f(3.3,0.3,3.8);
        glEnd();
        glBegin(GL_QUADS);
        glTexCoord2f (0,0);
        glVertex3f(-3.3,0.3,4.2);
        glTexCoord2f (0,0.644531);
        glVertex3f(-3.3,0.3,3.8);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(-3.3,0.7,3.8);
        glTexCoord2f (0.976563,0);
        glVertex3f(-3.3,0.7,4.2);
        glEnd();
        glBegin(GL_QUAD_STRIP);
        glTexCoord2f (0,0);
        glVertex3f(0.7,0.3,9);
        glTexCoord2f (0,0.644531);
        glVertex3f(-0.7,0.3,9);
        glTexCoord2f (0.976563,0);
        glVertex3f(0.7,-0.3,9);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(-0.7,-0.3,9);
        glTexCoord2f (0,0);
        glVertex3f(0.7,-0.3,9.4);
        glTexCoord2f (0,0.644531);
        glVertex3f(-0.7,-0.3,9.4);
        glTexCoord2f (0.976563,0);
        glVertex3f(0.7,0.3,9.4);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(-0.7,0.3,9.4);
        glTexCoord2f (0,0);
        glVertex3f(0.7,0.3,9);
        glTexCoord2f (0,0.644531);
        glVertex3f(-0.7,0.3,9);
        glEnd();
        glBegin(GL_QUADS);
        glTexCoord2f (0,0);
        glVertex3f(0.7,0.3,9);
        glTexCoord2f (0,0.644531);
        glVertex3f(0.7,0.3,9.4);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(0.7,-0.3,9.4);
        glTexCoord2f (0.976563,0);
        glVertex3f(0.7,-0.3,9);
        glEnd();
        glBegin(GL_QUADS);
        glTexCoord2f (0,0);
        glVertex3f(-0.7,0.3,9);
        glTexCoord2f (0,0.644531);
        glVertex3f(-0.7,-0.3,9);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(-0.7,-0.3,9.4);
        glTexCoord2f (0.976563,0);
        glVertex3f(-0.7,0.3,9.4);
        glEnd();
        glBegin(GL_QUAD_STRIP);
        glTexCoord2f (0,0);
        glVertex3f(0.7,2.5,0);
        glTexCoord2f (0,0.644531);
        glVertex3f(0.7,0.3,9);
        glTexCoord2f (0.976563,0);
        glVertex3f(0.7,2.1,0);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(0.7,0,9);
        glTexCoord2f (0,0);
        glVertex3f(0.3,2.1,0);
        glTexCoord2f (0,0.644531);
        glVertex3f(0.3,0,9);
        glTexCoord2f (0.976563,0);
        glVertex3f(0.3,2.4,0);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(0.3,0.3,9);
        glTexCoord2f (0,0);
        glVertex3f(0.7,2.5,0);
        glTexCoord2f (0,0.644531);
        glVertex3f(0.7,0,9);
        glEnd();
        glBegin(GL_QUAD_STRIP);
        glTexCoord2f (0,0);
        glVertex3f(-0.7,2.5,0);
        glTexCoord2f (0,0.644531);
        glVertex3f(-0.7,0.3,9);
        glTexCoord2f (0.976563,0);
        glVertex3f(-0.7,2.1,0);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(-0.7,0,9);
        glTexCoord2f (0,0);
        glVertex3f(-0.3,2.1,0);
        glTexCoord2f (0,0.644531);
        glVertex3f(-0.3,0,9);
        glTexCoord2f (0.976563,0);
        glVertex3f(-0.3,2.4,0);
        glTexCoord2f (0.976563,0.644531);
        glVertex3f(-0.3,0.3,9);
        glTexCoord2f (0,0);
        glVertex3f(-0.7,2.5,0);
        glTexCoord2f (0,0.644531);
        glVertex3f(-0.7,0.3,9);
        glEnd();
        glDisable( GL_TEXTURE_2D );
        glEnable( GL_CULL_FACE );
        glPopMatrix ();
        glEndList ();
}
