#include "trebuchetdrawer.h"
#include <GL/glu.h>
#include <QOpenGLTexture>

TrebuchetDrawer::TrebuchetDrawer()
{
    textureWood = NULL;
}


void TrebuchetDrawer::loadAndBlindWood(){
    if(textureWood == NULL){
        textureWood = new QOpenGLTexture(QImage(":/textures/wood.png").mirrored());
        textureWood->setMinificationFilter(QOpenGLTexture::LinearMipMapLinear);
        textureWood->setMagnificationFilter(QOpenGLTexture::Linear);
    }
    textureWood->bind();
}

void TrebuchetDrawer::drawPlankClose(){

    glEnable( GL_TEXTURE_2D );
    glDisable( GL_CULL_FACE );
    loadAndBlindWood();
    glPushMatrix();
        glMatrixMode( GL_MODELVIEW );
        glEnable(GL_TEXTURE_GEN_S);
        glEnable(GL_TEXTURE_GEN_T);
        gluQuadricTexture(gluNewQuadric(),GL_TRUE);

        glBegin(GL_QUAD_STRIP);
            glVertex3f(-0.3,0,-.3);
            glVertex3f(-0.3,0,.3);
            glVertex3f(-0.3,0.6,-.3);
            glVertex3f(-0.3,0.6,.3);
            glVertex3f(0.3,.6,-.3);
            glVertex3f(0.3,.6,.3);
            glVertex3f(0.3,0,-.3);
            glVertex3f(.3,0,.3);
            glVertex3f(-0.3,0,-.3);
            glVertex3f(-0.3,0,.3);
        glEnd();
        glBegin(GL_QUADS);
            glVertex3f(-.3,0,-.3);
            glVertex3f(.3,0,-.3);
            glVertex3f(.3,.6,-.3);
            glVertex3f(-.3,.6,-.3);
        glEnd();
        glBegin(GL_QUADS);
            glVertex3f(-.3,0,.3);
            glVertex3f(.3,0,.3);
            glVertex3f(.3,.6,.3);
            glVertex3f(-.3,.6,.3);
        glEnd();

        glDisable(GL_TEXTURE_GEN_S);
        glDisable(GL_TEXTURE_GEN_T);
    glPopMatrix();
    glDisable( GL_TEXTURE_2D );
    glEnable( GL_CULL_FACE );

}

void TrebuchetDrawer::drawPlankOpen(){
    glEnable( GL_TEXTURE_2D );
    glDisable( GL_CULL_FACE );
    loadAndBlindWood();
    glPushMatrix();
        glMatrixMode( GL_MODELVIEW );
        glEnable(GL_TEXTURE_GEN_S);
        glEnable(GL_TEXTURE_GEN_T);
        gluQuadricTexture(gluNewQuadric(),GL_TRUE);

        glBegin(GL_QUAD_STRIP);
            glVertex3f(.3,.6,4.5);
            glVertex3f(.3,9,.3);
            glVertex3f(.3,.6,3.9);
            glVertex3f(.3,7.6,.3);
            glVertex3f(-.3,.6,3.9);
            glVertex3f(-.3,7.6,.3);
            glVertex3f(-.3,.6,4.5);
            glVertex3f(-.3,9,.3);
            glVertex3f(.3,.6,4.5);
            glVertex3f(.3,9,.3);
        glEnd();
        glBegin(GL_QUAD_STRIP);
            glVertex3f(.3,.6,-4.5);
            glVertex3f(.3,9,-.3);
            glVertex3f(.3,.6,-3.9);
            glVertex3f(.3,7.6,-.3);
            glVertex3f(-.3,.6,-3.9);
            glVertex3f(-.3,7.6,-.3);
            glVertex3f(-.3,.6,-4.5);
            glVertex3f(-.3,9,-.3);
            glVertex3f(.3,.6,-4.5);
            glVertex3f(.3,9,-.3);
        glEnd();

        glBegin(GL_QUAD_STRIP);
            glVertex3f(2.5,0,.7);
            glVertex3f(.3,9,.7);
            glVertex3f(2.1,0,.7);
            glVertex3f(0,9,.7);
            glVertex3f(2.1,0,.3);
            glVertex3f(0,9,.3);
            glVertex3f(2.4,0,.3);
            glVertex3f(.3,9,.3);
            glVertex3f(2.5,0,.7);
            glVertex3f(0,9,.7);
        glEnd();
        glBegin(GL_QUAD_STRIP);
            glVertex3f(2.5,0,-.7);
            glVertex3f(.3,9,-.7);
            glVertex3f(2.1,0,-.7);
            glVertex3f(0,9,-.7);
            glVertex3f(2.1,0,-.3);
            glVertex3f(0,9,-.3);
            glVertex3f(2.4,0,-.3);
            glVertex3f(.3,9,-.3);
            glVertex3f(2.5,0,-.7);
            glVertex3f(0,9,-.7);
        glEnd();

        glDisable(GL_TEXTURE_GEN_S);
        glDisable(GL_TEXTURE_GEN_T);
    glPopMatrix();
    glDisable( GL_TEXTURE_2D );
    glEnable( GL_CULL_FACE );

}
void TrebuchetDrawer::drawCylinder(){

    glEnable( GL_TEXTURE_2D );
    glDisable( GL_CULL_FACE );
    loadAndBlindWood();
    glPushMatrix();
        glMatrixMode( GL_MODELVIEW );
        glEnable(GL_TEXTURE_GEN_S);
        glEnable(GL_TEXTURE_GEN_T);
        gluQuadricTexture(gluNewQuadric(),GL_TRUE);
        gluCylinder(gluNewQuadric(),.5,.5,1,15,15);
        glBegin ( GL_TRIANGLES );
            glNormal3f(0.702714,-1.06018e-008,-0.711473);
            glVertex3f(.5,0,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(0.66832,0.21715,-0.711473);
            glVertex3f(0.475528,0.154509,0);
            glNormal3f(0.66832,0.21715,-0.711473);
            glVertex3f(0.475528,0.154509,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(0.568507,0.413045,-0.711473);
            glVertex3f(0.404509,0.293893,0);
            glNormal3f(0.568507,0.413045,-0.711473);
            glVertex3f(0.404509,0.293893,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(0.413045,0.568507,-0.711473);
            glVertex3f(0.293893,0.404509,0);
            glNormal3f(0.413045,0.568507,-0.711473);
            glVertex3f(0.293893,0.404509,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(0.21715,0.66832,-0.711473);
            glVertex3f(0.154508,0.475528,0);
            glNormal3f(0.21715,0.66832,-0.711473);
            glVertex3f(0.154508,0.475528,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(-6.36106e-008,0.702713,-0.711473);
            glVertex3f(-2.18557e-008,0.5,0);
            glNormal3f(-6.36106e-008,0.702713,-0.711473);
            glVertex3f(-2.18557e-008,0.5,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(-0.21715,0.66832,-0.711473);
            glVertex3f(-0.154509,0.475528,0);
            glNormal3f(-0.21715,0.66832,-0.711473);
            glVertex3f(-0.154509,0.475528,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(-0.413045,0.568507,-0.711473);
            glVertex3f(-0.293893,0.404509,0);
            glNormal3f(-0.413045,0.568507,-0.711473);
            glVertex3f(-0.293893,0.404509,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(-0.568507,0.413045,-0.711473);
            glVertex3f(-0.404509,0.293893,0);
            glNormal3f(-0.568507,0.413045,-0.711473);
            glVertex3f(-0.404509,0.293893,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(-0.66832,0.21715,-0.711473);
            glVertex3f(-0.475528,0.154508,0);
            glNormal3f(-0.66832,0.21715,-0.711473);
            glVertex3f(-0.475528,0.154508,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(-0.702714,-6.36106e-008,-0.711473);
            glVertex3f(-0.5,-4.37114e-008,0);
            glNormal3f(-0.702714,-6.36106e-008,-0.711473);
            glVertex3f(-0.5,-4.37114e-008,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(-0.66832,-0.21715,-0.711473);
            glVertex3f(-0.475528,-0.154508,0);
            glNormal3f(-0.66832,-0.21715,-0.711473);
            glVertex3f(-0.475528,-0.154508,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(-0.568507,-0.413045,-0.711473);
            glVertex3f(-0.404508,-0.293893,0);
            glNormal3f(-0.568507,-0.413045,-0.711473);
            glVertex3f(-0.404508,-0.293893,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(-0.413045,-0.568507,-0.711473);
            glVertex3f(-0.293893,-0.404509,0);
            glNormal3f(-0.413045,-0.568507,-0.711473);
            glVertex3f(-0.293893,-0.404509,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(-0.21715,-0.66832,-0.711473);
            glVertex3f(-0.154509,-0.475528,0);
            glNormal3f(-0.21715,-0.66832,-0.711473);
            glVertex3f(-0.154509,-0.475528,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(0,-0.702714,-0.711473);
            glVertex3f(5.96244e-009,-0.5,0);
            glNormal3f(0,-0.702714,-0.711473);
            glVertex3f(5.96244e-009,-0.5,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(0.217151,-0.66832,-0.711473);
            glVertex3f(0.154509,-0.475528,0);
            glNormal3f(0.217151,-0.66832,-0.711473);
            glVertex3f(0.154509,-0.475528,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(0.413045,-0.568507,-0.711473);
            glVertex3f(0.293893,-0.404508,0);
            glNormal3f(0.413045,-0.568507,-0.711473);
            glVertex3f(0.293893,-0.404508,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(0.568507,-0.413044,-0.711473);
            glVertex3f(0.404509,-0.293892,0);
            glNormal3f(0.568507,-0.413044,-0.711473);
            glVertex3f(0.404509,-0.293892,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(0.66832,-0.21715,-0.711473);
            glVertex3f(0.475528,-0.154508,0);
            glNormal3f(0.66832,-0.21715,-0.711473);
            glVertex3f(0.475528,-0.154508,0);
            glNormal3f(0,0,-1);
            glVertex3f(0,0,0);
            glNormal3f(0.702714,-1.06018e-008,-0.711473);
            glVertex3f(.5,0,0);
            glNormal3f(0.66832,0.21715,0.711473);
            glVertex3f(0.475528,0.154509,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(0.702714,-1.06018e-008,0.711473);
            glVertex3f(0.5,0,1);
            glNormal3f(0.568507,0.413045,0.711473);
            glVertex3f(0.404509,0.293893,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(0.66832,0.21715,0.711473);
            glVertex3f(0.475528,0.154509,1);
            glNormal3f(0.413045,0.568507,0.711473);
            glVertex3f(0.293893,0.404509,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(0.568507,0.413045,0.711473);
            glVertex3f(0.404509,0.293893,1);
            glNormal3f(0.21715,0.66832,0.711473);
            glVertex3f(0.154508,0.475528,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(0.413045,0.568507,0.711473);
            glVertex3f(0.293893,0.404509,1);
            glNormal3f(-6.36106e-008,0.702713,0.711473);
            glVertex3f(-2.18557e-008,0.5,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(0.21715,0.66832,0.711473);
            glVertex3f(0.154508,0.475528,1);
            glNormal3f(-0.21715,0.66832,0.711473);
            glVertex3f(-0.154509,0.475528,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(-6.36106e-008,0.702713,0.711473);
            glVertex3f(-2.18557e-008,0.5,1);
            glNormal3f(-0.413045,0.568507,0.711473);
            glVertex3f(-0.293893,0.404509,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(-0.21715,0.66832,0.711473);
            glVertex3f(-0.154509,0.475528,1);
            glNormal3f(-0.568507,0.413045,0.711473);
            glVertex3f(-0.404509,0.293893,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(-0.413045,0.568507,0.711473);
            glVertex3f(-0.293893,0.404509,1);
            glNormal3f(-0.66832,0.21715,0.711473);
            glVertex3f(-0.475528,0.154508,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(-0.568507,0.413045,0.711473);
            glVertex3f(-0.404509,0.293893,1);
            glNormal3f(-0.702714,-6.36106e-008,0.711473);
            glVertex3f(-0.5,-4.37114e-008,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(-0.66832,0.21715,0.711473);
            glVertex3f(-0.475528,0.154508,1);
            glNormal3f(-0.66832,-0.21715,0.711473);
            glVertex3f(-0.475528,-0.154508,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(-0.702714,-6.36106e-008,0.711473);
            glVertex3f(-0.5,-4.37114e-008,1);
            glNormal3f(-0.568507,-0.413045,0.711473);
            glVertex3f(-0.404508,-0.293893,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(-0.66832,-0.21715,0.711473);
            glVertex3f(-0.475528,-0.154508,1);
            glNormal3f(-0.413045,-0.568507,0.711473);
            glVertex3f(-0.293893,-0.404509,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(-0.568507,-0.413045,0.711473);
            glVertex3f(-0.404508,-0.293893,1);
            glNormal3f(-0.21715,-0.66832,0.711473);
            glVertex3f(-0.154509,-0.475528,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(-0.413045,-0.568507,0.711473);
            glVertex3f(-0.293893,-0.404509,1);
            glNormal3f(0,-0.702714,0.711473);
            glVertex3f(5.96244e-009,-0.5,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(-0.21715,-0.66832,0.711473);
            glVertex3f(-0.154509,-0.475528,1);
            glNormal3f(0.217151,-0.66832,0.711473);
            glVertex3f(0.154509,-0.475528,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(0,-0.702714,0.711473);
            glVertex3f(5.96244e-009,-0.5,1);
            glNormal3f(0.413045,-0.568507,0.711473);
            glVertex3f(0.293893,-0.404508,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(0.217151,-0.66832,0.711473);
            glVertex3f(0.154509,-0.475528,1);
            glNormal3f(0.568507,-0.413044,0.711473);
            glVertex3f(0.404509,-0.293892,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(0.413045,-0.568507,0.711473);
            glVertex3f(0.293893,-0.404508,1);
            glNormal3f(0.66832,-0.21715,0.711473);
            glVertex3f(0.475528,-0.154508,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(0.568507,-0.413044,0.711473);
            glVertex3f(0.404509,-0.293892,1);
            glNormal3f(0.702714,-1.06018e-008,0.711473);
            glVertex3f(0.5,0,1);
            glNormal3f(0,0,1);
            glVertex3f(0,0,1);
            glNormal3f(0.66832,-0.21715,0.711473);
            glVertex3f(0.475528,-0.154508,1);
        glEnd ();
        glDisable(GL_TEXTURE_GEN_S);
        glDisable(GL_TEXTURE_GEN_T);
    glPopMatrix();
    glDisable( GL_TEXTURE_2D );
    glEnable( GL_CULL_FACE );

}

void TrebuchetDrawer::drawArmature(){
    glEnable( GL_TEXTURE_2D );
    glDisable( GL_CULL_FACE );

    glMatrixMode( GL_MODELVIEW );
    glPushMatrix ();
        glTranslatef(0,0,0);
        glScalef(1,1,10/.6);
        drawPlankClose();
    glPopMatrix ();
    glPushMatrix ();
        glTranslatef(0,4.2,-.35);
        glRotatef(90,1,0,0);
        glScalef(1,1,8.4/.6);
        drawPlankClose();
    glPopMatrix ();
    glPushMatrix ();
        glTranslatef(0,8.7,0);
        glScalef(1,1,1.4/.6);
        drawPlankClose();
    glPopMatrix ();
    glPushMatrix();
        drawPlankOpen();
    glPopMatrix();
    glPushMatrix ();
        glTranslatef(0.6,4,0);
        glScalef(1,1,6.6/.6);
        drawPlankClose();
    glPopMatrix ();
    glDisable( GL_TEXTURE_2D );
    glEnable( GL_CULL_FACE );
}

void TrebuchetDrawer::drawTrebuchet(int rotX, int rotY){
    glEnable( GL_TEXTURE_2D );
    glDisable( GL_CULL_FACE );
    glPushMatrix();
        glMatrixMode( GL_MODELVIEW );
        glRotatef(rotY,0,1,0);
        glPushMatrix ();
            glRotatef(90,0,1,0);
            glScalef(1,1,10/.6);
            drawPlankClose();
        glPopMatrix ();

        glPushMatrix ();
            glTranslatef(1.5,0,0);
            drawArmature();
        glPopMatrix ();

        glPushMatrix ();
            glTranslatef(-1.5,0,0);
            glRotatef(-180,0,1,0);
            drawArmature();
        glPopMatrix ();

        glPushMatrix ();
            glTranslatef(-1.2,9,0);
            glRotatef(rotX,1,0,0);
            glRotatef(90,0,1,0);
            glScalef(1,1,2.4);
            drawCylinder();
            glPushMatrix ();
                glTranslatef(3.7,0,.5);
                glRotatef(90,0,1,0);
                glScalef(1,1,17/.6);
                drawPlankClose();
            glPopMatrix ();

            glPushMatrix ();
                glTranslatef(-3.9,-1.1,.5);
                glScalef(3,3,1.5);
                drawPlankClose();
            glPopMatrix ();
        glPopMatrix ();

    glPopMatrix();
    glDisable( GL_TEXTURE_2D );
    glEnable( GL_CULL_FACE );

}
